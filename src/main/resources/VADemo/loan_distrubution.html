<!DOCTYPE html>
<head>
   <meta charset="utf-8">
    <title>贷款产品总分布情况</title>
</head>
<style>
    body {
        font: 30px arial;
        font-size: 14px;
        
    }

    #content {
        height: 100%;
        width: 100%;
        margin: 0 auto;
        text-align: center;
        background-color: #fff;
        padding-top: 30px;
    }

    #loanScatter {
        background-color: #fff;
        margin: 0px 50px 30px 20px;
		box-shadow: 2px 2px 10px #888888;
    }
    .left, .right{
		width: 46%;
        background-color: #fff;
        margin: 20px 10px 30px 20px;
        float: left;
		box-shadow: 2px 2px 10px #888888;
    }
    .center_title {
        font-size: 14px;
        color: white;
        margin: 0 auto;
        padding: 10px 0px;
        text-align: left;
        text-indent: 1em;
		background-color: rgb(10, 24, 92);
		border-top-left-radius: 5px;
		border-top-right-radius: 5px;
		
    }

    .title {
        font-size: 14px;
        color: white;
        margin-left: 20px;
        margin-right: 50px;
        padding: 10px 0px;
        text-align: left;
        text-indent: 1em;
		background-color: rgb(10, 24, 92);
	  border-top-left-radius: 5px;
	  border-top-right-radius: 5px;
    }

    #list_box {
		width: 100%;
        color: white;
        margin: 0 auto;
        text-align: center;
        padding-bottom: 30px;
        float: left;
        background-color: #fff;
		
    }

    #list {
        background-color: #fff;
        margin-left: 20px;
        margin-right: 50px;
		box-shadow: 2px 2px 10px #888888;
    }

    .tb_title, #tb_title {
        color: #7a7b89;
    }

    .tb_title {
        width: 150px;
    }

    #tb_title {
        height: 45px;
    }

    #tab {
		margin:auto;
        text-align: center;
    }

    table tr td {
        border: 1px solid #424562;
        width: 100px;
        height: 30px;
		color:#666
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #666;
        shape-rendering: crispEdges;
    }

    .axis text {
        fill: #666;
        font-family: sans-serif;
        font-size: 11px;
    }

    .legend text {
        fill: #666;
        font-family: sans-serif;
        font-size: 11px;
    }
</style>
<body>
<div id="content">
    <div class="chart_box">
        <div class="title">各产品的不良率、总余额与不良余额</div>
        <div id="loanScatter"></div>
    </div>
    <div class="chart_box left">
        <div class="center_title"> 产品分布-客户(Customer Distribution By Product)</div>
        <div id="loanCusPie"></div>
    </div>
    <div class="chart_box right">
        <div class="center_title">产品分布 - 余额(Balance Distribution By Product)</div>
        <div id="loanBalPie"></div>
    </div>
    <div id="list_box">
        <div class="title">贷款产品分布情况(Retail Loan Distribution By Product)</div>
        <div id="list">
            <table id="tab">
                <tr id="tb_title">
                    <td rowspan="2" colspan="2" class="tb_title">产品类别<br/>Product Type</td>
                    <td colspan="6" class="tb_title">时间 Date：2018.4</td>
                </tr>
                <tr>
                    <td class="tb_title">存量客户数<br/> Customers</td>
                    <td class="tb_title">占比<br/>Customers<br/>Percentage</td>
                    <td class="tb_title">余额<br/>Principal</td>
                    <td class="tb_title">占比<br>Principal<br>Percentage</td>
                    <td class="tb_title">不良余额<br>NPL</td>
                    <td class="tb_title">不良率<br>NPL Percentage</td>
                </tr>
                <tr>
                    <td rowspan="4" class="tb_title">个人贷款<br/>Personal Loan</td>
                    <td class="tb_title">个人住房贷款</td>
                    <td>230000</td>
                    <td>15.23%</td>
                    <td>2541</td>
                    <td>13.27%</td>
                    <td>44</td>
                    <td>1.73%</td>
                </tr>
                <tr>
                    <td class="tb_title">个人商用房贷款</td>
                    <td>200000</td>
                    <td>13.25%</td>
                    <td>5808</td>
                    <td>13.27%</td>
                    <td>49</td>
                    <td>0.84%</td>
                </tr>
                <tr>
                    <td class="tb_title">个人消费贷款</td>
                    <td>150000</td>
                    <td>9.93%</td>
                    <td>4060</td>
                    <td>14.29%</td>
                    <td>65</td>
                    <td>1.60%</td>
                </tr>
                <tr>
                    <td class="tb_title">个人经营性贷款</td>
                    <td>170000</td>
                    <td>11.26%</td>
                    <td>1621</td>
                    <td>17.33%</td>
                    <td>64</td>
                    <td>3.95%</td>
                </tr>
                <tr>
                    <td class="tb_title">小微企业贷款<br/>SME</td>
                    <td class="tb_title">小微企业贷款</td>
                    <td>180000</td>
                    <td>11.92%</td>
                    <td>3710</td>
                    <td>15.31%</td>
                    <td>119</td>
                    <td>3.21%</td>
                </tr>
                <tr>
                    <td rowspan="2" class="tb_title">信用卡<br/>Credit Card</td>
                    <td class="tb_title">传统业务</td>
                    <td>270000</td>
                    <td>17.88%</td>
                    <td>3408</td>
                    <td>10.03%</td>
                    <td>54</td>
                    <td>1.58%</td>
                </tr>
                <tr>
                    <td class="tb_title">创新业务</td>
                    <td>310000</td>
                    <td>20.53%</td>
                    <td>2115</td>
                    <td>18.55%</td>
                    <td>57</td>
                    <td>2.70%</td>
                </tr>
                <tr>
                    <td class="tb_title">合计 Total</td>
                    <td></td>
                    <td>1510000</td>
                    <td>100%</td>
                    <td>151000000</td>
                    <td>100%</td>
                    <td>452</td>
                    <td>0.03%</td>
                </tr>
            </table>
        </div>
    </div>
</div>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/img-common.css">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<script type="text/javascript" >
	var data1=[	 {x0: "个人住房贷款", y0: 819},
				 {x0: "个人商用房贷款", y0: 593},
				 {x0: "个人消费贷款", y0: 470},
				 {x0: "个人经营性贷款", y0: 319},
				 {x0: "小微企业贷款", y0: 312},
				 {x0: "传统业务", y0: 303},
				 {x0: "创新业务", y0: 463},
			]
	var pie={	baseId: "a114277d42484c86b5e5b1864446a7e7",
				height: 600,
				id: "15",
				innerRadius: 0,
				labelsDisplay: 1,
				labelsFont: "宋体",
				labelsFontColor: "#666",
				labelsFontSize: 18,
				labelsLocation: "center",
				outerRadius: 100,
				padBottom: 20,
				padLeft: 10,
				padRight: 50,
				padTop: 20,
				pictureFont: "宋体",
				pictureFontColor: "#666",
				pictureFontSize: 16,
				pictureSymbol: null,
				pieName: "产品分布 - 余额",
				title: null,
				titleColor: "#8c0a4b",
				titleFont: "宋体",
				titleFontSize: 20,
				titleLocation: "center",
				width: 600
			}
	var label1="#loanCusPie";
	var label2="#loanBalPie";
	pieP(data1,pie,label1);
	pieP(data1,pie,label2);
	scatter();
	function pieP(data,pieattr,label){
		     d3.select(label).select("svg").remove();
            var datax = [];// 提取x轴数据
            var datay = [];// 提取y轴数据
            var mm = toData(data);
            var data = targetToArray(datax, datay);
            var colordata = [];
            for (var i = 0; i < data.length; i++) {
                var d = data[i][0];
                colordata.push(d);
            }
            console.log(data);
            var width = pieattr.width;// - vm.pie.padLeft -vm.pie.padRight;
            // //SVG绘制区域的宽度
            var height = pieattr.height;// - vm.pie.padTop - vm.pie.padBottom;
            // //SVG绘制区域的高度

            var svg = d3.select(label)			// 选择<body>
            // .select("div.col-sm-6 height-auto")
                .append("svg")
                .append("g")
                .attr("transform", "translate(" + (width / 3.2) + "," + (height / 3.2) + ")");

            var slices = svg.append("g")
                .attr("class", "slices");
            var labelText = svg.append("g")
                .attr("class", "labelText");
            var labelLine = svg.append("g")
                .attr("class", "labelLine");

            d3.select(label).select("svg") // 在<body>中添加<svg>
                .attr("width", width - 130) // 设定<svg>的宽度属性
                .attr("height", height - 100 - 100)// 设定<svg>的高度属性
                .style("background-color", "#fff");


            // 1.确定初始数据
            var dataset = data;
            // 2.转换数据
            var pie = d3.pie()
                .value(function (d) {
                    return d[1];
                });
            var piedata = pie(dataset);
           
            // 3.绘制
            // 字体大小
            var fontsize = pieattr.labelsFontSize - 8;
            // 外半径和内半径
            var outerRadius = pieattr.outerRadius;
            var innerRadius = pieattr.innerRadius;
            // 创建弧生成器
            var arc = d3.arc()
                .innerRadius(innerRadius)
                .outerRadius(outerRadius);
            var largeArc = d3.arc()
                .innerRadius(0)
                .outerRadius(outerRadius*1.1);
            var color = d3.scaleOrdinal()
                .domain(piedata)
                .range(["#3080ff", "#ff5b8d", "#955bff", "#ffbd3e", "#4ccb72", "#f87e7e","#19d3ff"]);
            var arcs = svg.select(".slices").selectAll(".arc")
                .data(pie(dataset));
            var path = svg.select(".slices").selectAll(".arc")
                .data(pie(dataset))
                .enter()
                .append("path")
                .attr("class", "arc");
            path.attr("id", function (d) {
                return d.data[0];
            })
                .attr("fill", function (d, i) {
                    return color(d.data[0]);	// 设定弧的颜色
                })
                .attr("d", function (d) {
                    return arc(d);	// 使用弧生成器（角度转化为弧度）
                })
                .each(function (d) {
                    this._current = d;
                });// console.log(d);

            // 初始化动画
            path.transition()
                .duration(500)
                .ease(d3.easeExp)
                .attrTween("d", tweenPie);

            // 添加一个提示框
            var tooltip = d3.select(label)
                .append("div")
                .attr("class", "tooltip")
                .style("opacity", 0.0);

            path.on("mouseover", function (d) {
                /*
                 * 鼠标移入时， （1）通过 selection.html() 来更改提示框的文字 （2）通过更改样式 left 和
                 * top 来设定提示框的位置 （3）设定提示框的透明度为1.0（完全不透明）
                 */
				 
				
                tooltip.html(d.data[0] + "" + "<br />" + d.data[1] + "")
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY + 20) + "px")
                    .style("opacity", 9.0)
                    .style("font-size", "14px")// vm.pie.toolTipFontSize
                    .style("font-famliy","MicrosoftYaHei")// vm.pie.tooltipFont
					.style("background","#63676c")// piep.toolTipbgcolor
					.style("color","#fff")
					.style('font-weight','normal')
					.style('font-stretch','normal')
					.style('letter-spacing','0px')
					.style('border-radius','5px')
					.style('text-align','center')



                d3.select(this).transition()// 选择节点设置
                    .duration(300)
                    .ease(d3.easeElastic)
                    .attr('d', largeArc)

                // var currPath = d3.select("#loanCusPie");
                var currPath = d3.select(this);
                var darkenedColor = d3.rgb(color(d.data[0])).brighter(0.2);// brighter()
                currPath.attr('fill', darkenedColor);
            })
                .on("mousemove", function (d) {
                    /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */

                    tooltip.style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY + 20) + "px");
                })
                .on("mouseout", function (d) {
                    /* 鼠标移出时，将透明度设定为0.0（完全透明） */
                    d3.select(this).transition()
                        .duration(300)
                        .ease(d3.easeElastic)
                        .attr('d', arc)
                    // var currPath = d3.select("#loanCusPie");
                    var currPath = d3.select(this);
                    var darkenedColor = d3.rgb(color(d.data[0])).brighter(0);// brighter()
                    currPath.attr('fill', darkenedColor);
                    tooltip.style("opacity", 0.0);
                });

            function tweenPie(b) {
                b.innerRadius = 0;
                var i = d3.interpolate({startAngle: 0, endAngle: 0}, b);
                return function (t) {
                    return arc(i(t));
                };
            };

            var legendRectSize = 18,
                legendSpacing = 4;
            // 图例
            var legend = svg.selectAll('.legend')
                .data(colordata)
                .enter()
                .append('g')
                .attr('class', 'legend')
                .attr('transform', function (d, i) {

                    var height = legendRectSize + legendSpacing,
                        offset = height * color.domain().length / 2,
                        horz = -2 * legendRectSize,
                        vert = i * height + 100 - offset - 100+5;
                    return 'translate(' + 150 + ',' + vert + ')';

                });

            var lA = svg.select(".labelLine").append("g").attr("class", "lA");
            var lB = svg.select(".labelLine").append("g").attr("class", "lB");

            legend.append('rect')
                .attr('width', 20)
                .attr('height', 10)
                .attr('rx',2)
                .attr('ry',2)
                .style('fill', color)
                .style('stroke', color)
                .on('mouseover', function (d) {
                    // var currPath = d3.select("#loanCusPie");
                    var currPath = d3.select(this);
                    var darkenedColor = d3.rgb(color(d)).brighter(0.4);// brighter()
                    currPath.style('fill', darkenedColor);
                    var path1 = d3.select(this.parentNode.parentNode).select('.slices').select('#' + d);
                    path1.transition()// 选择节点设置
                        .duration(300)
                        .ease(d3.easeElastic)
                        .attr('d', largeArc)
                })
                .on('mouseout', function (d) {
                    // var currPath = d3.select("#loanCusPie");
                    var currPath = d3.select(this);
                    var darkenedColor = d3.rgb(color(d)).brighter(0);// brighter()
                    currPath.style('fill', darkenedColor);
                    var path1 = d3.select(this.parentNode.parentNode).select('.slices').select('#' + d);
                    path1.transition()// 选择节点设置
                        .duration(300)
                        .ease(d3.easeElastic)
                        .attr('d', arc)
                })
                .on('click', function (d1) {
                    // console.log(d1+"---------------");
                    var data1;
                    var rect = d3.select(label);// 当前dom元素
                    var enabled = true;

                    var totalEnabled = d3.sum(dataset.map(function (d) {
                        // console.log(d);
                        return (d[2]) ? 1 : 0;
                    }));

                    if (rect.attr('class') === "disabled") {
                        rect.attr('class', '');
                    } else {
                        if (totalEnabled < 2) return;
                        rect.attr('class', 'disabled');
                        enabled = false;
                    }

                    // 重新排序
                    pie.value(function (d, i) {
                        if (d[0] === d1) d[2] = enabled;
                        return (d[2]) ? d[1] : 0;
                    });

                    var temp = [];

                    update();

                    function update() {
                        path = path.data(pie(dataset));

                        path.transition()
                            .duration(300)
                            .ease(d3.easeExp)
                            .attrTween('d', function (d) {
                                var interpolate = d3.interpolate(this._current, d);
                                this._current = interpolate(0);
                                return function (t) {
                                    return arc(interpolate(t));
                                };
                            });
                        path.exit().remove();
                    }

                    lA = svg.select(".labelLine").select(".lA");
                    lB = svg.select(".labelLine").select(".lB");
                    console.log(lA);
                    updataLinesAndText(dataset);
                });

            svg.selectAll('.legend')
                .data(pie(dataset))
                .append('text')
                .attr('x', 23)// 图例字体与图例水平距离
                .attr('y', 9)// 图例字体竖直距离
                .attr("font-size","12px")
                .text(function (d) {
                    // console.log(d.data);d.data表示数组中的一个对象；d表示数组；d.data.type表示数组中每个对象的属性
                    return d.data[0];
                });


            updataLinesAndText(dataset);

            function updataLinesAndText(dd) {

                var text = svg.select(".labelText").selectAll("text")
                    .data(pie(dd));
                // 绘制弧内的文字
                text.enter()
                    .append("text")
                text.attr("transform", function (d) {
                    var x = arc.centroid(d)[0] * 1.4;		// 文字的x坐标
                    var y = arc.centroid(d)[1] * 1.4;		// 文字的y坐标
                    return "translate(" + x + "," + y + ")";
                })
                    .attr("text-anchor", "middle")
                    .style("font-size", fontsize)
                    .attr('fill','#fff')
                    .text(function (d) {
                        // 计算市场份额的百分比
                        var percent = Number(d.value) / d3.sum(dd, function (d) {
                            return d[1];
                        }) * 100;

                        // 保留1位小数点，末尾加一个百分号返回
                        return percent.toFixed(2) + "%";
                    });
                text.exit().remove();
                // 添加直线弧外连接元素

                var lineA = lA.selectAll("line")
                    .data(pie(dd));
                lineA.enter().append("line")

                lineA.transition().duration(500).attr("class", "lineA")
                    .attr("stroke", function (d, i) {
                        return color(d.data[0]);
                    })
                    .attr("x1", function (d) {
                        return arc.centroid(d)[0] * 2;
                    })// 连接直线是否在圆弧内
                    .attr("y1", function (d) {
                        return arc.centroid(d)[1] * 2;
                    })
                    .attr("x2", function (d) {
                        return arc.centroid(d)[0] * 2.5;
                    })// 连接直线长度
                    .attr("y2", function (d) {
                        return arc.centroid(d)[1] * 2.5;
                    });
                lineA.exit().remove();

                var lineB = lB.selectAll("line")
                    .data(pie(dd));
                lineB.enter().append("line");
                lineB.transition().duration(500).attr("class", "lineB")
                    .style("stroke", function (d, i) {
                        return color(d.data[0]);
                    })
                    .each(function (d) {
                        d.textLine = {x1: 0, y1: 0, x2: 0, y2: 0};
                    })
                    .attr("x1", function (d) {
                        d.textLine.x1 = arc.centroid(d)[0] * 2.5;
                        return d.textLine.x1;
                    })
                    .attr("y1", function (d) {
                        d.textLine.y1 = arc.centroid(d)[1] * 2.5;
                        return d.textLine.y1;
                    })
                    .attr("x2", function (d) {
                        // console.log(d.data[0]);
                        var strLen = getPixelLength(d.data[0], fontsize) * 1.5;
                        var bx = arc.centroid(d)[0] * 2.5;
                        d.textLine.x2 = bx >= 0 ? bx + strLen : bx - strLen;
                        return d.textLine.x2;
                    })
                    .attr("y2", function (d) {
                        d.textLine.y2 = arc.centroid(d)[1] * 2.5;
                        return d.textLine.y2;
                    });
                lineB.exit().remove();
                // 绘制弧外的文字
                var lineC = lB.selectAll("text").data(pie(dd));

                lineC.enter().append("text");
                lineC.transition().duration(500).attr("class", "textOUT")
                    .attr("transform", function (d) {
                        var x1 = arc.centroid(d)[0] * 2.5;
                        var strLen = getPixelLength(d.data[0], fontsize) * 1.5;
                        var bx = arc.centroid(d)[0] * 2.5;
                        var x2 = bx >= 0 ? bx + strLen : bx - strLen;
                        var y1 = arc.centroid(d)[1] * 2.5;
                        var x = 0;
                        var y = 0;
                        x = (x1 + x2) / 2;
                        y = y1;
                        y = y > 0 ? y + fontsize * 0.8 + 3 : y - fontsize * 0.4;
                        return "translate(" + x + "," + y + ")";
                    })
                    .style("text-anchor", "middle")
                    .style("font-size", fontsize)
                    .style("fill","#666")
                    .text(function (d) {
                        return d.data[0];
                    });
                lineB.exit().remove();

                function getPixelLength(str, fontsize) {
                    var curLen = 0;
                    for (var i = 0; i < str.length; i++) {
                        var code = str.charCodeAt(i);
                        var pixelLen = code > 255 ? fontsize : fontsize / 2;
                        curLen += pixelLen;
                    }
                    return 15;
                }
            }


            var cc = targetToObject(datax, datay);

            function toData(jsdata) {
                var n = 0;

                for (var a = 0; a < jsdata.length; a++) {//数组长度
                    var data1 = "";
                    for (var i = 0; i < Object.keys(jsdata[0]).length; i++) {//对象长度
                        var xb = Object.keys(jsdata[a]).some(key  => key.includes('x' + i)
                            )
                        ;
                        var yb = Object.keys(jsdata[a]).some(key  => key.includes('y' + i)
                            )
                        ;

                        if (xb == true & Object.keys(jsdata[0]).length != 2) {
                            data1 += jsdata[a]['x' + i] + "_";
                            //console.log(data1);
                        }
                        if (xb == true & Object.keys(jsdata[0]).length == 2) {
                            data1 += jsdata[a]['x' + i];
                        }
                        if (xb == false & i != 1 & i != 0) {
                            if (i % 2 == 0 & i != 2) {
                                n = i - 1;
                            } else {
                                n = i;
                            }
                        }
                        if (xb == false & i == 1 || xb == false & i == 0) {
                            n = 1;
                        }
                    }
                    ;
                    if (Object.keys(jsdata[0]).length != 2) {
                        data1 = data1.substring(0, data1.lastIndexOf('_'));
                        datax.push(data1);
                    } else {
                        datax.push(data1);
                    }
                }
                ;
                for (var i = 0; i < Object.keys(jsdata[0]).length - n; i++) {
                    datay[i] = [];
                }
                for (var a = 0; a < jsdata.length; a++) {//数组长度
                    var data2;
                    for (var i = 0; i < Object.keys(jsdata[0]).length; i++) {//对象长度
                        var xb = Object.keys(jsdata[a]).some(key => key.includes('x' + i)
                            )
                        ;
                        var yb = Object.keys(jsdata[a]).some(key  => key.includes('y' + i)
                            )
                        ;
                        if (yb == true) {
                            data2 = jsdata[a]['y' + i];
                            datay[i].push(data2);
                        }
                        ;
                    }
                    ;
                }
                ;
            }

            //后台数据转为数组:[[],[],...]
            function targetToArray(datax, datay) {

                var dataset = [];
                //for(var i=0;i<datay.length;i++){
                //   dataset[i]=[];
                //}
                for (var i = 0; i < datax.length; i++) {
                    for (var j = 0; j < datay.length; j++) {
                        var obj = [
                            datax[i],
                            datay[j][i],
                            true
                        ]
                        dataset.push(obj);
                    }

                }
                return dataset;
            }

            //后台数据转为数组对象:[{},{},...]
            function targetToObject(datax, datay) {
                var dataset = [];//封装数据
                for (var i = 0; i < datay.length; i++) {
                    dataset[i] = [];
                }
                for (var i = 0; i < datax.length; i++) {
                    for (var j = 0; j < datay.length; j++) {
                        var obj = {
                            angle: 1,
                            type: datax[i],
                            value: datay[j][i],
                            enabled: true
                        }
                        dataset[j].push(obj);
                    }
                }
                return dataset;
            }
	}
	function scatter(){
			var datanum=[
				{sepalWidth:1.73,sepalLength:2541.0,species:"个人住房贷款"},
				{sepalWidth:0.84,sepalLength:5808.0,species:"个人商用房贷款"},
				{sepalWidth:1.6,sepalLength:4060.0,species:"个人消费贷款"},
				{sepalWidth:3.95,sepalLength:1621.0,species:"个人经营性贷款"},
				{sepalWidth:3.21,sepalLength:3710.0,species:"小微企业贷款"},
				{sepalWidth:1.58,sepalLength:3408.0,species:"传统业务"},
				{sepalWidth:2.7,sepalLength:2115.0,species:"创新业务"}]
			var scatter={
					baseId: "50f29d961c374776a2d5c7d0a35ec2ed",
					canvasColor: "#fff",
					circleFillOpacity: 1,
					circleRadius: 6,
					height: 400,
					id: 3,
					legendFontFamily: "arial,微软雅黑",
					legendFontSize: 11,
					legendHeight: 10,
					legendPosition: 720,
					legendTextPositionl: 750,
					legendTextPositiont: 7,
					legendWidth: 20,
					legentTextAnchor: "start",
					padBottom: 40,
					padLeft: 120,
					padRight: 100,
					padTop: 30,
					scatterName: "各产品的不良率、总余额与不良余额",
					width: 960,
					xaFontFamily: "arial,#343654",
					xaFontSize: 11,
					xaLabelAnchor: "end",
					xaLabelPositionx: 30,
					xaLabelPositiony: 450,
					xaScalePosition: "bottom",
					xaText: "",
					xformat: "1",
					yaFontFamily: "arial,微软雅黑",
					yaFontSize: 11,
					yaLabelAnchor: "end",
					yaLabelPosition: -50,
					yaScalePosition: "left",
					yaText: "",
					yformat: "0"}
			var margin = {
                top: parseInt(scatter.padTop),
                right: parseInt(scatter.padRight),
                bottom: parseInt(scatter.padBottom),
                left: parseInt(scatter.padLeft)
            };	//上下左右边距
            var width = scatter.width - margin.left - margin.right;
            var height = scatter.height - margin.top - margin.bottom;
            var Format = d3.format("%");
            var x = d3.scaleLinear().range([0, width]);
            var y = d3.scaleLinear().range([height, 0]);
            var tooltip = d3.select("#loanScatter").append("div").attr("class", "tooltip").style("opacity", 0);
            var color = d3.scaleOrdinal().range(
                ["#0cf1d9", "#3080ff", "#ff5b8d", "#955bff", "#ffbd3e", "#4ccb72", "#f87e7e"]);
            var xformat = "";
            var yformat = "";
            if (scatter.xformat == "1") {
                xformat = "%";
            }
            if (scatter.yformat == "1") {
                yformat = "%";
            }
            var xAxis = d3.axisBottom(x)//svg.axis().scale(x)
			.tickFormat(function (v) {
                    return v + xformat;
                })
			//.orient(scatter.xaScalePosition);						//x轴刻度位置
            var yAxis = d3.axisLeft(y)//svg.axis().scale(y).
			.tickFormat(function (v) {
                    return v + yformat;
                })
			//.orient(scatter.yaScalePosition);					   //y轴刻度位置
            d3.select("#loanScatter").select("svg").remove();
            var svg = d3.select("#loanScatter").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .style("background-color", scatter.canvasColor)			//画布背景颜色
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            var data = datanum;
            x.domain(d3.extent(data, function (d) {
                return d.sepalWidth;
            })).nice();
            y.domain(d3.extent(data, function (d) {
                return d.sepalLength;
            })).nice();

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis)
                .append("text")
                .attr("class", "label")
                .attr("x", scatter.xaLabelPositiony)							//x标签距y轴距离
                .attr("y", scatter.xaLabelPositionx)							//x标签距x轴距离
                .style("text-anchor", scatter.xaLabelAnchor)				//x标签对齐方式
                .text(scatter.xaText)  				//x轴名称
                .style("font-family", scatter.xaFontFamily)				//x标签字体样式
                .style("font-size", scatter.xaFontSize + "px");			//x标签字体大小

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("class", "label")
                .attr("transform", "rotate(-90)")
                .attr("y", scatter.yaLabelPosition)								//y标签到y轴的距离
                .attr("dy", ".71em")
                .style("text-anchor", scatter.yaLabelAnchor)				//y标签对齐方式
                .text(scatter.yaText)				//y轴名称
                .style("font-family", scatter.yaFontFamily)                //y标签字体样式
                .style("font-size", scatter.yaFontSize + "px");				//y标签字体大小

            svg.selectAll(".dot")
                .data(data)
                .enter().append("circle")
                .attr("class", "radarCircle")
                .attr("r", 0)
                .transition()
                .duration(400)
                .attr("r", scatter.circleRadius)	      //数据点半径
                .attr("cx", function (d) {
                    return x(d.sepalWidth);
                })
                .attr("cy", function (d) {
                    return y(d.sepalLength);
                })
                .style("fill", function (d) {
                    return color(d.species);
                })
                .style("fill-opacity", scatter.circleFillOpacity);				//数据点填充透明度
            svg.selectAll("circle")
                .on("mouseover", function (d) {
                    d3.select(this)
                        .attr("r", scatter.circleRadius * 1.5)
                        .style("fill-opacity", 0.5);
                    tooltip.html(d.sepalWidth + xformat + "," + d.sepalLength + yformat);
                    tooltip.style("left", (d3.event.pageX - 50) + "px")
                        .style("top", (d3.event.pageY - 40) + "px")
                        .style("opacity", 1)
                        .style("color","white");
                })
                .on("mouseout", function () {
                    d3.select(this)
                        .attr("r", scatter.circleRadius)
                        .style("fill-opacity", 1);
                    tooltip.style("opacity", 0)
                });
            var legend = svg.selectAll(".legend")
                .data(color.domain())
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", function (d, i) {
                    return "translate(0," + i * 20 + ")";
                });

            legend.append("rect")
                .attr("x", scatter.legendPosition)					//图例位置
                .attr("width", scatter.legendWidth)						//图例宽度
                .attr("height", scatter.legendHeight)						//图例高度
                .attr('rx',2)
                .attr('ry',2)
                .style("fill", color);

            legend.append("text")
                .attr("x", scatter.legendTextPositionl)					//图例文字距左边位置
                .attr("y", scatter.legendTextPositiont)								//图例文字距顶部位置
                .attr("dy", ".35em")
                .style("font-family", scatter.legendFontFamily)	//图例文字样式
                .style("font-size", scatter.legendFontSize + "px")				//图例文字大小
                .style("text-anchor", scatter.legentTextAnchor)				//图例文字对齐方式
                .text(function (d) {
                    return d;
                });
	}
</script>
</body>
</html>