<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>编辑管理员</title>
 
</head>
	
	
<style>
#content{
	height:100%;
	width:100%;
	margin:0 auto;
	text-align:center;
	/*background-color: #0e131a;*/
	padding-top:30px;
}

#comtre{
	margin:0px 30px 30px 30px;
  box-shadow: 2px 2px 10px #888888;
}
.title{
	font-size: 14px;
	color:white;
	background-color: rgb(10, 24, 92);
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
	margin-left:30px;
	margin-right:30px;
	padding:10px 0px;
	text-align: left;
	text-indent: 1em;
}

#list_box{
	color:white;
	margin:0 auto;
	text-align:center;
	padding-bottom:30px;
}
#list{
	/*background-color: #20252d;*/
	margin-left:30px;
	margin-right:30px;
}
.tb_title,#tb_title{
	color:#666;
}
.tb_title{
	width:150px;
}
#tb_title{
	height:45px;
}

#tab{
	text-align:center;
}
table tr td{
	border:1px solid #424562;
	width:100px;
	height:30px;
	color:#666;
}
/* 坐标轴样式 */
    .axis path,
    .axis line{
    fill: none;
    stroke: #666;
    shape-rendering: crispEdges;
	}
	.axis text {
	  fill:#666;
    font-family: sans-serif;
    font-size: 11px;
	}

 /*提示框*/
 .tooltip .title{
 border-bottom:1px solid #666;
 text-align:center;
 }  
 .tooltip .desColor{
 width:10px;
 height:10px;
 float:left;
 margin:9px 8px 1px 8px;
 }
 .tooltip .desText{
 display:inline;
 }

</style>
	
	
<body>
<div id="content">
	<div class="chart_box">
 		<div class="title">信用卡贷款（按季度）</div>
        <div id="comtre"></div>
    </div>
    
    <div id="list_box">
    	<div class="title">信用卡贷款（按季度）</div>
    	<div id="list">
    		<table id="tab">
    			<tr id="tb_title">
    				<td class="tb_title">季度</td>
    				<td>2013-Q2</td>
    				<td>2013-Q3</td>
    				<td>2013-Q4</td>
    				<td>2014-Q1</td>
    				<td>2014-Q2</td>
    				<td>2014-Q3</td>
    				<td>2014-Q4</td>
    				<td>2015-Q1</td>
    				<td>2015-Q2</td>
    				<td>2015-Q3</td>
    				<td>2015-Q4</td>
    				<td>2016-Q1</td>
    			</tr>
    			<tr>
    				<td class="tb_title">客户量<br>Customers</td>
    				<td>80</td>
    				<td>69</td>
    				<td>66</td>
    				<td>58</td>
    				<td>80</td>
    				<td>72</td>
    				<td>76</td>
    				<td>69</td>
    				<td>80</td>
    				<td>95</td>
    				<td>90</td>
    				<td>73</td>
    			</tr>
    			<tr>
    				<td class="tb_title">余额<br>Principai</td>
    				<td>2000</td>
    				<td>1900</td>
    				<td>2100</td>
    				<td>1700</td>
    				<td>2000</td>
    				<td>1700</td>
    				<td>2000</td>
    				<td>1700</td>
    				<td>2000</td>
    				<td>1700</td>
    				<td>2000</td>
    				<td>1700</td>
    			</tr>
    		</table>
    	</div>
    </div>
    
</div>

<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/img-common.css">
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<script type="text/javascript" >
	joint();
	function joint(){
			var dataset=[
				 2000,
				 1900,
				 2100,
				 1700,
				 2000,
				 1700,
				 2000,
				 1700,
				 2000,
				 1700,
				 2000,
				 1700,
			];

			var xMarks=[
				'2013-Q2',
				'2013-Q3',
				'2013-Q4',
				'2014-Q1',
				'2014-Q2',
				'2014-Q3',
				'2014-Q4',
				'2015-Q1',
				'2015-Q2',
				'2015-Q3',
				'2015-Q4',
				'2016-Q1',
			];

			var w=800;

			var h=400;

			var padding=40;
			//用一个变量存储标题和副标题的高度，如果没有标题什么的，就为0
			var head_height=padding;
			//用一个变量计算底部的高度，如果不是多系列，就为0
			//var margin = {top: vm.jointFigure.padTop, right: vm.jointFigure.padRight, bottom: vm.jointFigure.padBottom, left: vm.jointFigure.padLeft};
			var foot_height=padding;

		 var data=[
			    80,
				69,
				66,
				58,
				80,
				72,
				76,
				69,
				80,
				95,
				90,
				73
		 ];
			 //vm.leftdata=data;
			// vm.rightdata=data2;
			//模拟数据

		//	getData();



			//定义画布
			var svg=d3.select("#comtre")
				.append("svg")
				.attr("width",w)
				.attr("height",h);
			//添加画布背景
				svg.append("g")
				.append("rect")
				.attr("x",0)
				.attr("y",0)
				.attr("width",w)
				.attr("height",h)
				.style("fill","#fff")
				.style("stroke-width",2)
				.style("stroke","none");

		    //添加标题
//		    if(title!=""){
//			  svg.append("g")
//				.append("text")
//				.text(title)
//				.attr("class","title")
//				.attr("x",w/2)
//				.attr("y",head_height);
//				head_height+=30;
//			}

		//添加副标题

//			if(subTitle!="")
//			{
//				svg.append("g")
//					.append("text")
//				.text(subTitle)
//				.attr("class","subTitle")
//				.attr("x",w/2)
//				.attr("y",head_height);
//				head_height+=20;
//
//			}

		//横坐标轴比例尺

			var xScale = d3.scale.linear()
				.domain([0,dataset.length])//0,14
				.range([padding,w-padding]);//40,560



		//纵坐标轴比例尺

			var yScale = d3.scale.linear()
					.domain([0,d3.max(data)])
					.range([h-foot_height,head_height]);//360,40
		//右边纵轴比例尺
			var yScale2 = d3.scale.linear()
				.domain([0,d3.max(dataset)])
				.range([h-foot_height,head_height]);//360,40		

		//定义横轴

			var xAxis = d3.svg.axis()
					.scale(xScale)
					.orient("bottom").ticks(dataset.length);//14dataset.length

		//添加横坐标轴并通过编号获取对应的横轴标签

			var xBar=svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (h - padding) + ")")
				.call(xAxis)
				.selectAll("text")
				.attr("x",20)
				.attr("y",9)
				.text(function(d,i){return xMarks[i];});

		//定义纵轴

			var yAxis = d3.svg.axis()
					.scale(yScale)
					.orient("left").ticks(10);
			
			var yAxis2=d3.svg.axis()
					.scale(yScale2)
					.orient("right").ticks(10);

			//添加纵轴

			var yBar=svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate("+padding+",0)")
				.call(yAxis)
				.append("text")
				.attr("dy", 3 + "em")
                .attr("dx", -2 + "em")
                .style("fill", "#666")
                .text("客户量")
                .style("font-size", "11px")
				;
			
			var yBar2=svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate("+(w-padding)+",0)")
				.call(yAxis2)
				.append("text")
				.attr("dy", 3 + "em")
                .attr("dx", -1 + "em")
                .style("fill", "#666")
                .text("余额")
                .style("font-size", "11px")
				;
			
			
			//添加柱图
			var bar=svg.append("g")
			        .attr("class","bar")
					.selectAll("rect")
					.data(data)
					.enter()
					.append("rect")
					.attr("fill","rgb(10, 24, 92)")
					.attr("x",function(d,i){return xScale(i)+10;})
					.attr("y",function(d){return yScale(d);})
					.attr("width",30)
					.attr("height",function(d,i){ return h - yScale(d)-40;});
					
			/*var bar1=svg.append("g")
			        .attr("class","bar1")
					.selectAll("rect")
					.data(data2)
					.enter()
					.append("rect")
					.attr("fill","green")
					.attr("x",function(d,i){return xScale(i)+20;})
					.attr("y",function(d){return yScale2(d);})
					.attr("width",10)
					.attr("height",function(d,i){ return h - yScale2(d)-40;});*/
			
		
			var line = d3.svg.line()
				.x(function(d,i){return xScale(i)+20;})
				.y(function(d){return yScale2(d);});



			var path=svg.append("g")
			    .attr("class","line")
			    .append("path")
			    .attr("class","duration")
				.attr("d", line(dataset))
				.style("fill","none")
				.style("stroke-width",1)
				.style("stroke","#cf2c39")//折线颜色
				.style("stroke-opacity",0.9);

			//在不知道折线的具体长度的时候可以动态添加动画属性。
        	 var path = document.getElementsByClassName('duration'); 
        	 var length =[];
        	 for(var h=0;h<path.length;h++){
        	 length.push( path[h].getTotalLength());	
        	 }//获取class标签为line的元素
        				//获取第一个折线的总共的长度
        	 d3.selectAll('.duration')
        	 .style('stroke-dasharray', function(d,i){
        		 return length[i]
        	 })					//根据上面获取的值来设置stroke-dasharray值
        	 .style('stroke-dashoffset', function(d,i){
        		 return length[i]
        	 });

        	 var rule = "@keyframes dash {0%{stroke-dashoffset:" + length + ";}100%{ stroke-dashoffset: 0;}  }";
        	 var style = document.createElement('style');
        	 style.type = 'text/css';
        	 style.innerHTML = rule;
        	document.getElementsByTagName('head')[0].appendChild(style);
        	for(var i=0;i<path.length;i++){
	         	 path[i].style.animation = "dash 2s linear forwards";//加载动画时间

        	}
		
			/*var area_generator = d3.svg.area()
		        .x(function(d, i) {
		            return xScale(i)+20;
		        }) //x坐标点的值为data数组的下标，参数d表示传进来的数据，i表示下标
		        .y0(h-40) //y0表示y轴
		        .y1(function(d) {
		            return yScale2(d)
		        }) //y1表示实际曲线上的值
		        .interpolate("linear") //让线条变得光滑，不是折线而是光滑的曲线

		    // 当页面有多个相同元素，select只能选择符合条件的第一个元素，想要选择其中某一个指定的元素，可以把那个元素赋给一个变量，然后使用变量名去实现
		    // 如下所示，g表示上面赋值的那个变量g,而不是标签<g></g>
		   path.attr("d", area_generator(dataset)).style("fill", "none")//steelblue
*/		    	

				
			//提示框
//			var tooltip = d3.select("body")
//								.append("div")
//								.attr("class","tooltip")
//								.style("opcity",0.0);
//			var title = tooltip.append("div")
//								.attr("class","title");
//			var des = tooltip.selectAll(".des")
//								.data(dataset)
//								.enter()
//								.append("div");
//			var desColor = des.append("div")
//								.attr("class","desColor");
//			var desText = des.append("div")
//			         			.attr("class","desText");
//			
			//添加一条垂直X轴的对齐线
			var Vline = svg.append("line")
			.attr("class","focusLine")
			.style("display","none");
			var tooltip = d3.select("body")
			.append("div")
			.attr("class","tooltip")
			.style("opacity",0.0);
			//添加元素点
					svg.selectAll('circle')
					.data(dataset)
					.enter()
					.append('g')
					.append('circle')
					.attr('fill',"#cf2c39")
					.attr("cx", function(d,i) {
						return xScale(i)+20;
					})
					.attr("cy", function(d) {
						return yScale2(d);
					})
					.attr('r', 5)
					.on('mouseover',
					function(d) {
						d3.select(this).transition()
						        .duration(500)
						     //   .ease(d3.easeElastic)
								.attr('r', 7);
						 tooltip.html(d)
							    .style("left", (d3.event.pageX) + "px")
		                        .style("top", (d3.event.pageY + 20) + "px")
		                        .style("opacity", 1.0)
		                        .style("font-size","14px")
			                    .style("font-weight","normal")
			                    .style("font-stretch","normal")
			                    .style("letter-spacing","0px")
			                    .style("color","#666")
			                    .style("font-family","MicrosoftYaHei")
			                    .style("background-color","#63676c")
			                    .style("border-radius","5px")
		//						vline.style("display",null);
					}).on('mouseout',
					function() {
						d3.select(this).transition()
						     .duration(500)
						     .attr('r', 5);
						tooltip.style("opacity",0.0);
//						vline.style("display","none");
					})
					

			//重新作图

			function drawChart()
			{
				//getData();
				yBar.transition().duration(1000).call(yAxis);
				yBar2.transition().duration(1000).call(yAxis2);
				//纵轴数据更新

				yScale = d3.scale.linear()
					.domain([0,d3.max(data)])
					.range([h-padding,head_height]);
				
				
					yScale2 = d3.scale.linear()
					.domain([0,d3.max(dataset)])
					.range([h-padding,head_height]);

				//重绘路径

				//path.transition().duration(1000).attr("d", line(dataset));

				//重绘4圆点

				svg.selectAll("circle")
					.data(dataset)
					.transition()
					.duration(1000)
					.attr("cx", function(d,i) {
						return xScale(i)+20;
					})
					.attr("cy", function(d) {
						return yScale(d);
					})

			}

	}
</script>
</body>
</html>

